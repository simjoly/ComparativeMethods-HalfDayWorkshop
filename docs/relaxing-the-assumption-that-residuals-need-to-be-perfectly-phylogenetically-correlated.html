<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Relaxing the assumption that residuals need to be perfectly phylogenetically correlated | Half-day Workshop on Phylogenetic Comparative Methods</title>
<meta name="author" content="Simon Joly">
<meta name="description" content="Phylogenetic Generalized Least Squares assume that the residuals are perfectly phylogenetically correlated. This is relatively constraining because it means that other sources of errors that are...">
<meta name="generator" content="bookdown 0.41 with bs4_book()">
<meta property="og:title" content="7 Relaxing the assumption that residuals need to be perfectly phylogenetically correlated | Half-day Workshop on Phylogenetic Comparative Methods">
<meta property="og:type" content="book">
<meta property="og:url" content="https://simjoly.github.io/ComparativeMethods-HalfDayWorkshop/relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated.html">
<meta property="og:description" content="Phylogenetic Generalized Least Squares assume that the residuals are perfectly phylogenetically correlated. This is relatively constraining because it means that other sources of errors that are...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Relaxing the assumption that residuals need to be perfectly phylogenetically correlated | Half-day Workshop on Phylogenetic Comparative Methods">
<meta name="twitter:description" content="Phylogenetic Generalized Least Squares assume that the residuals are perfectly phylogenetically correlated. This is relatively constraining because it means that other sources of errors that are...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Half-day Workshop on Phylogenetic Comparative Methods</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="before.html"><span class="header-section-number">2</span> Ahead of the workshop</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">3</span> An introduction to Phylogenetic Comparative Methods</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">4</span> The linear regression model</a></li>
<li><a class="" href="pgls.html"><span class="header-section-number">5</span> Phylogenetic generalized least squares (PGLS)</a></li>
<li><a class="" href="pic.html"><span class="header-section-number">6</span> Phylogenetic Independent Contrasts</a></li>
<li><a class="active" href="relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated.html"><span class="header-section-number">7</span> Relaxing the assumption that residuals need to be perfectly phylogenetically correlated</a></li>
<li><a class="" href="phylogenetic-anova.html"><span class="header-section-number">8</span> Phylogenetic ANOVA</a></li>
<li><a class="" href="model-testing.html"><span class="header-section-number">9</span> Model testing</a></li>
<li><a class="" href="when-should-we-use-comparative-methods.html"><span class="header-section-number">10</span> When should we use comparative methods?</a></li>
<li><a class="" href="a-final-word-the-problem-of-replication.html"><span class="header-section-number">11</span> A final word: the problem of replication</a></li>
<li><a class="" href="BM-model.html"><span class="header-section-number">12</span> The Brownian Motion (BM) model</a></li>
<li><a class="" href="further-readings.html"><span class="header-section-number">13</span> Further readings</a></li>
<li><a class="" href="trees.html"><span class="header-section-number">14</span> Introduction to phylogenies in R</a></li>
<li><a class="" href="solutions.html"><span class="header-section-number">15</span> Solutions to the challenges</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Relaxing the assumption that residuals need to be perfectly phylogenetically correlated<a class="anchor" aria-label="anchor" href="#relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated"><i class="fas fa-link"></i></a>
</h1>
<p>Phylogenetic Generalized Least Squares assume that the residuals are perfectly phylogenetically correlated. This is relatively constraining because it means that other sources of errors that are not phylogenetically correlated are not allowed by the model. Moreover, if these exist, they can bias the results of the PGLS <span class="citation">(<a href="references.html#ref-revell2010phylogenetic">Revell 2010</a>)</span>.</p>
<p>There are ways to relax this assumption, and one of this is to use a type of correlation structure that allows to relax this assumption.</p>
<div id="theory-pagels-correlation-structure" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Theory: Pagel’s correlation structure<a class="anchor" aria-label="anchor" href="#theory-pagels-correlation-structure"><i class="fas fa-link"></i></a>
</h2>
<p>When controling for phylogenetic relationships with phylogenetic generalized least squares, we assume that the residuals are perfectly correlated according to the correlation structure. In practice, it might not be always the case and it is difficult to really know how important it is to control for the phylogenetic relationship in a specific case. For instance, for a given study, the correlation in the residuals might not be highly phylogenetically correlated.</p>
<p>This is possible to account for this using the <span class="math inline">\(\lambda\)</span> model of Pagel <span class="citation">(<a href="references.html#ref-pagel1999inferring">Pagel 1999</a>)</span>. The idea is to multiply the off-diagonal of the correlation matrix (essentially the branch lengths of the phylogeny) by a parameter <span class="math inline">\(\lambda\)</span>, but not the diagonal values. This essentially leads to a modification of branch lengths of the phylogeny. A <span class="math inline">\(\lambda\)</span> value near zero gives very shorts internal branches and long tip branches. This, in effect, reduces the phylogenetic correlations (the effect of the phylogeny is reduced). At the opposite, if <span class="math inline">\(\lambda\)</span> is close to 1, then the modified phylogeny resembles the true phylogeny. Indeed, the parameter <span class="math inline">\(\lambda\)</span> is often interpreted as a parameter of phylogenetic signal; as such, a greater <span class="math inline">\(\lambda\)</span> value implies a stronger phylogenetic signal.</p>
<p>The following figure shows how different lambda values affect the shape of the Quebec trees phylogeny.</p>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/alpha%20example-1.png" width="672" style="display: block; margin: auto;"></div>
<p>You can see that with small values of lambda, the weight given to the shared history (the phylogeny) are greatly reduced. The long terminal branches somewhat indicates that there could be a lot more variation in the residuals that are independent of the other species. This variation could be due to other factors that are included in the estimates of each species but that are independent of the phylogeny (such as measurement errors for instance).</p>
</div>
<div id="practicals-1" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Practicals<a class="anchor" aria-label="anchor" href="#practicals-1"><i class="fas fa-link"></i></a>
</h2>
<p>Pagel’s <span class="math inline">\(\lambda\)</span> model can be used in PGLS using the <code>corPagel</code> correlation structure. The usage of this correlation structure is similar to that of the <code>corBrownian</code> structure, except that you need to provide a starting parameter value for <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the correlation structure</span></span>
<span><span class="va">pagel.corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/corPagel.html">corPagel</a></span><span class="op">(</span><span class="fl">0.3</span>, phy<span class="op">=</span><span class="va">seedplantstree</span>, fixed<span class="op">=</span><span class="cn">FALSE</span>, form<span class="op">=</span><span class="op">~</span><span class="va">Code</span><span class="op">)</span></span></code></pre></div>
<p>The value given to <code>corPagel</code> is the starting value for the <span class="math inline">\(\lambda\)</span> parameter. Also, note that the option <code>fixed=</code> is set to <code>FALSE</code> This means that the <span class="math inline">\(\lambda\)</span> parameter will be optimized using generalized least squares. If it was set to <code>TRUE</code>, then the model would be fitted with the starting parameter, here <code>0.3</code>. The <code>form=~Code</code> points to the column <code>Code</code> of the dataset for ordering the tree in the same order as the dataframe when fitting the function.</p>
<p>Let’s now fit the PGLS with this correlation structure.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PGLS with coraPagel</span></span>
<span><span class="va">shade.pgls2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html">gls</a></span><span class="op">(</span><span class="va">Shade</span> <span class="op">~</span> <span class="va">Wd</span>, data <span class="op">=</span> <span class="va">seedplantsdata</span>, correlation<span class="op">=</span><span class="va">pagel.corr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">shade.pgls2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: Shade ~ Wd 
##   Data: seedplantsdata 
##        AIC     BIC    logLik
##   163.3967 171.426 -77.69833
## 
## Correlation Structure: corPagel
##  Formula: ~Code 
##  Parameter estimate(s):
##    lambda 
## 0.9581665 
## 
## Coefficients:
##                Value Std.Error   t-value p-value
## (Intercept) 1.254987  1.636575 0.7668377  0.4465
## Wd          3.573527  1.497808 2.3858381  0.0205
## 
##  Correlation: 
##    (Intr)
## Wd -0.397
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -0.75145692 -0.44908843 -0.05417524  0.25655008  0.96493685 
## 
## Residual standard error: 2.621947 
## Degrees of freedom: 57 total; 55 residual</code></pre>
<p>You can see that gls has estimated the <span class="math inline">\(\lambda\)</span> parameter, which is 0.958 here. Because the estimated <span class="math inline">\(\lambda\)</span> is very close to 1, we can conclude that residuals of the model were strongly phylogenetically correlated. This, in turns, thus confirms the importance of using a PGLS with this model. If the <span class="math inline">\(\lambda\)</span> estimated would have been close to 0, it would have suggested that the PGLS is not necessary. Note, however, that using this approach assures you to never obtained a biased statistical result. Actually, I <strong>strongly recommend</strong> that you always use this correlation structure in your statistical analyses.</p>
</div>
<div id="challenge-4" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Challenge 4<a class="anchor" aria-label="anchor" href="#challenge-4"><i class="fas fa-link"></i></a>
</h2>
<p>Try to fit a PGLS with a Pagel correlation structure when regressing Shade tolerance on seed mass. Are the residuals as phylogenetically correlated than in the previous regression with wood density?</p>
</div>
<div id="other-correlation-structures-or-evolutionary-models" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Other correlation structures (or evolutionary models)<a class="anchor" aria-label="anchor" href="#other-correlation-structures-or-evolutionary-models"><i class="fas fa-link"></i></a>
</h2>
<p>The correlation structures available in the package <code>ape</code> offer other alternatives for the assumed model of character evolution. For instance, the <code>corMartins</code> correlation structure models selection using the Ornstein-Uhlenbeck (or Hansen) model with parameter <span class="math inline">\(\alpha\)</span> that determines the strength of the selection. Also, <code>corBlomberg</code> models accelerating or decelerating Brownian evolution, that is, the evolutionary rate of the Brownian motion is either accelerating or decelerating with time with this model. It is possible to do model comparisons to decide which model best fit the residual variation.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="pic.html"><span class="header-section-number">6</span> Phylogenetic Independent Contrasts</a></div>
<div class="next"><a href="phylogenetic-anova.html"><span class="header-section-number">8</span> Phylogenetic ANOVA</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated"><span class="header-section-number">7</span> Relaxing the assumption that residuals need to be perfectly phylogenetically correlated</a></li>
<li><a class="nav-link" href="#theory-pagels-correlation-structure"><span class="header-section-number">7.1</span> Theory: Pagel’s correlation structure</a></li>
<li><a class="nav-link" href="#practicals-1"><span class="header-section-number">7.2</span> Practicals</a></li>
<li><a class="nav-link" href="#challenge-4"><span class="header-section-number">7.3</span> Challenge 4</a></li>
<li><a class="nav-link" href="#other-correlation-structures-or-evolutionary-models"><span class="header-section-number">7.4</span> Other correlation structures (or evolutionary models)</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Half-day Workshop on Phylogenetic Comparative Methods</strong>" was written by Simon Joly. It was last built on 2024-11-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
