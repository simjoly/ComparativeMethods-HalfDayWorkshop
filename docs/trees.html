<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>14 Introduction to phylogenies in R | Half-day Workshop on Phylogenetic Comparative Methods</title>
<meta name="author" content="Simon Joly">
<meta name="description" content="There are lots of packages for phylogenetic analyses in R. I won’t enumerate them all here, but you can have a good idea of the options available by looking at the phylogenetic R vignette...">
<meta name="generator" content="bookdown 0.41 with bs4_book()">
<meta property="og:title" content="14 Introduction to phylogenies in R | Half-day Workshop on Phylogenetic Comparative Methods">
<meta property="og:type" content="book">
<meta property="og:url" content="https://simjoly.github.io/ComparativeMethods-HalfDayWorkshop/trees.html">
<meta property="og:description" content="There are lots of packages for phylogenetic analyses in R. I won’t enumerate them all here, but you can have a good idea of the options available by looking at the phylogenetic R vignette...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="14 Introduction to phylogenies in R | Half-day Workshop on Phylogenetic Comparative Methods">
<meta name="twitter:description" content="There are lots of packages for phylogenetic analyses in R. I won’t enumerate them all here, but you can have a good idea of the options available by looking at the phylogenetic R vignette...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Half-day Workshop on Phylogenetic Comparative Methods</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="before.html"><span class="header-section-number">2</span> Ahead of the workshop</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">3</span> An introduction to Phylogenetic Comparative Methods</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">4</span> The linear regression model</a></li>
<li><a class="" href="pgls.html"><span class="header-section-number">5</span> Phylogenetic generalized least squares (PGLS)</a></li>
<li><a class="" href="pic.html"><span class="header-section-number">6</span> Phylogenetic Independent Contrasts</a></li>
<li><a class="" href="relaxing-the-assumption-that-residuals-need-to-be-perfectly-phylogenetically-correlated.html"><span class="header-section-number">7</span> Relaxing the assumption that residuals need to be perfectly phylogenetically correlated</a></li>
<li><a class="" href="phylogenetic-anova.html"><span class="header-section-number">8</span> Phylogenetic ANOVA</a></li>
<li><a class="" href="model-testing.html"><span class="header-section-number">9</span> Model testing</a></li>
<li><a class="" href="when-should-we-use-comparative-methods.html"><span class="header-section-number">10</span> When should we use comparative methods?</a></li>
<li><a class="" href="a-final-word-the-problem-of-replication.html"><span class="header-section-number">11</span> A final word: the problem of replication</a></li>
<li><a class="" href="BM-model.html"><span class="header-section-number">12</span> The Brownian Motion (BM) model</a></li>
<li><a class="" href="further-readings.html"><span class="header-section-number">13</span> Further readings</a></li>
<li><a class="active" href="trees.html"><span class="header-section-number">14</span> Introduction to phylogenies in R</a></li>
<li><a class="" href="solutions.html"><span class="header-section-number">15</span> Solutions to the challenges</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="trees" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Introduction to phylogenies in R<a class="anchor" aria-label="anchor" href="#trees"><i class="fas fa-link"></i></a>
</h1>
<p>There are lots of packages for phylogenetic analyses in R. I won’t enumerate them all here, but you can have a good idea of the options available by looking at the <a href="http://cran.r-project.org/web/views/Phylogenetics.html">phylogenetic R vignette</a> maintainned by Brian O’Meara. It is mostly oriented towards phylogenetic comparative methods, but it is a good start.</p>
<p>The most basic package for using trees in R is <em>ape</em>, which allows you to read and plot trees.</p>
<div id="importing-and-plotting-trees" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Importing and plotting trees<a class="anchor" aria-label="anchor" href="#importing-and-plotting-trees"><i class="fas fa-link"></i></a>
</h2>
<div id="simulate-a-tree" class="section level3" number="14.1.1">
<h3>
<span class="header-section-number">14.1.1</span> Simulate a tree<a class="anchor" aria-label="anchor" href="#simulate-a-tree"><i class="fas fa-link"></i></a>
</h3>
<p>Throughout these exercises, we will often use simulated trees, which are very useful for pedagogical purposes. Trees can be simulated using several functions, but here is an example to simulate one tree with 15 species.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/pbtree.html">pbtree</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">15</span>,nsim<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Simulate%20Pure-Birth%20Tree-1.png" width="672"></div>
<p>You save the tree in nexus format to a file. But before you do so, it is a good idea to set the working directory to the same folder where your script is saved. You can do that in RStudio in the menu Session&gt;Set Working Directory&gt;To Source File Location.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape">ape</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/write.nexus.html">write.nexus</a></span><span class="op">(</span><span class="va">tree</span>, file<span class="op">=</span><span class="st">"My_first_tree.tre"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="simulating-characters" class="section level3" number="14.1.2">
<h3>
<span class="header-section-number">14.1.2</span> Simulating characters<a class="anchor" aria-label="anchor" href="#simulating-characters"><i class="fas fa-link"></i></a>
</h3>
<p>Characters can also be easily simulated in R. For instance, you could simulate a character using a Brownian Motion (BM) model using the following code.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trait1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/fastBM.html">fastBM</a></span><span class="op">(</span><span class="va">tree</span>, sig2<span class="op">=</span><span class="fl">0.01</span>, nsim<span class="op">=</span><span class="fl">1</span>, internal<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># To get trait values for tree tips:</span></span>
<span><span class="va">trait1</span></span></code></pre></div>
<pre><code>##           t3           t4           t7           t8           t2          t14 
## -0.007306853  0.043251831  0.004858391 -0.114795593 -0.043737891  0.113964926 
##          t15           t9          t12          t13           t5           t6 
##  0.097243984  0.096978766  0.063069656  0.053040643  0.072476832  0.034675083 
##           t1          t10          t11 
## -0.084659118  0.118596501  0.059071786</code></pre>
<p>Now, let’s save this trait to a file to pretend it is our original data.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">trait1</span>,ncol<span class="op">=</span><span class="fl">1</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trait1</span><span class="op">)</span>,<span class="st">"trait1"</span><span class="op">)</span><span class="op">)</span>, file<span class="op">=</span><span class="st">"mytrait.csv"</span>, sep<span class="op">=</span><span class="st">";"</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have simulated a tree and a character, let’s erase what we have done so far from the R environment and pretend these are our data for the next sections.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="import-data-into-r" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Import data into R<a class="anchor" aria-label="anchor" href="#import-data-into-r"><i class="fas fa-link"></i></a>
</h2>
<p>Here is how you should import your data into R.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html">read.nexus</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"My_first_tree.tre"</span><span class="op">)</span></span>
<span><span class="va">trait1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv2</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"mytrait.csv"</span>,dec<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>The tree format in ape contains several information and it is useful to know how to access them. For instance, the tip labels can be accessed using <code>tree$tip.label</code> and the branch lengths using <code>tree$edge.length</code>. Will will see more options in other exercises, but if you want more detailed information on how the objects “phylo” are organized, you can have a look the help file <code><a href="https://rdrr.io/pkg/ape/man/read.tree.html">?read.tree</a></code> or at this <a href="http://ape-package.ird.fr/misc/FormatTreeR_24Oct2012.pdf">document</a> prepared by Emmanuel Paradis, the author of <code>ape</code>.</p>
</div>
<div id="plot-trees" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Plot trees<a class="anchor" aria-label="anchor" href="#plot-trees"><i class="fas fa-link"></i></a>
</h2>
<p>Plotting trees is one of the very interesting aspects of using R. Options are numerous and possibilities large. The most common function is <code>plot.phylo</code> from the ape package that has a lot of different options. I strongly suggest that you take a close look at the different options of the function <code><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html">?plot.phylo</a></code>. Here is a basic example.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tree</span>, type<span class="op">=</span><span class="st">"c"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/add.scale.bar.html">add.scale.bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Basic%20tree%20plotting-1.png" width="672"></div>
<p>But R is also interesting to plot characters alongside trees. If you have a categorical character, you could use it to color the tips of the phylogeny.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a random categorical character</span></span>
<span><span class="va">trait2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Create color palette</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">ColorPalette1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">trait2</span><span class="op">)</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tree</span>, type<span class="op">=</span><span class="st">"p"</span>, use.edge.length <span class="op">=</span> <span class="cn">TRUE</span>, label.offset<span class="op">=</span><span class="fl">0.2</span>,cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">tiplabels</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">21</span>,bg<span class="op">=</span><span class="va">ColorPalette1</span><span class="op">[</span><span class="va">trait2</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"black"</span>,cex<span class="op">=</span><span class="fl">1</span>,adj<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">op</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">trait2</span><span class="op">)</span>,col<span class="op">=</span><span class="va">ColorPalette1</span>,</span>
<span>       pch<span class="op">=</span><span class="fl">20</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1</span>,pt.cex<span class="op">=</span><span class="fl">1.5</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">trait2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Plot%20categorical%20parameter-1.png" width="672"></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span> <span class="co">#reset graphical parameters to defaults</span></span></code></pre></div>
<p>A similar result could be obtained with a continuous variable. Here, we will use the Brownian Motion model, which we will study in a further class, to simulate the continuous character.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Breakdown continuous trait in categories</span></span>
<span><span class="va">trait1.cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">trait1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,breaks<span class="op">=</span><span class="fl">8</span>,labels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Create color palette</span></span>
<span><span class="va">ColorPalette2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>, name <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span></span>
<span><span class="co"># Plot the tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tree</span>, type<span class="op">=</span><span class="st">"p"</span>, use.edge.length <span class="op">=</span> <span class="cn">TRUE</span>, label.offset<span class="op">=</span><span class="fl">0.2</span>,cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">tiplabels</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">21</span>,bg<span class="op">=</span><span class="va">ColorPalette2</span><span class="op">[</span><span class="va">trait1.cat</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"black"</span>,cex<span class="op">=</span><span class="fl">1</span>,adj<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">op</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">trait1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,breaks<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="va">ColorPalette2</span>,pch<span class="op">=</span><span class="fl">20</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">0.7</span>,pt.cex<span class="op">=</span><span class="fl">1.5</span>,ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Plot%20continuous%20parameter-1.png" width="672"></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span> <span class="co">#reset graphical parameters to defaults</span></span></code></pre></div>
<p>As expected from a character simlated with Brownian motion, you can see that closely related species tend to have more similar character values.</p>
<p>Another option to represent a continuous parameter is to use the function <code>table.phylo4d</code> from the <code>adephylo</code> package to represent the trait where its values are represented by sizes of different sizes and colors. It is also possible to plot multiple characters at the same time.</p>
<p>Note that you will have to install the packages <code>phylobase</code> and <code>adephylo</code> to run these function if they are not installed.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fmichonneau/phylobase">phylobase</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">adephylo</span><span class="op">)</span></span>
<span><span class="va">trait3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/fastBM.html">fastBM</a></span><span class="op">(</span><span class="va">tree</span>, sig2<span class="op">=</span><span class="fl">0.1</span>, nsim<span class="op">=</span><span class="fl">1</span>, internal<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">#simulate a faster evolving trait</span></span>
<span><span class="va">trait.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>trait1<span class="op">=</span><span class="va">trait1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">trait3</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html">phylo4d</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait.table</span><span class="op">)</span> <span class="co"># build a phylo4d object</span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/adephylo/man/table.phylo4d.html">table.phylo4d</a></span><span class="op">(</span><span class="va">obj</span>,cex.label<span class="op">=</span><span class="fl">1</span>,cex.symbol<span class="op">=</span><span class="fl">1</span>,ratio.tree<span class="op">=</span><span class="fl">0.8</span>,grid<span class="op">=</span><span class="cn">FALSE</span>,box<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Plot%20continuous%20parameter%20-%20table.phylo4d-1.png" width="672"></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span> <span class="co">#reset graphical parameters to defaults</span></span></code></pre></div>
<p>You can also represent a traitgram:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phenogram.html">phenogram</a></span><span class="op">(</span><span class="va">tree</span>,<span class="va">trait3</span>,spread.labels<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/traitgram-1.png" width="672"></div>
<p>Finally, it is also possible to represent a tree on a 2-dimensional plot, coloring points with the categorical variable.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phylomorphospace.html">phylomorphospace</a></span><span class="op">(</span><span class="va">tree</span>,<span class="va">trait.table</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">trait.table</span>,pch<span class="op">=</span><span class="fl">21</span>,bg<span class="op">=</span><span class="va">ColorPalette1</span><span class="op">[</span><span class="va">trait2</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"black"</span>,cex<span class="op">=</span><span class="fl">1.2</span>,adj<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">trait2</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="va">ColorPalette1</span>,pch<span class="op">=</span><span class="fl">20</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1</span>,pt.cex<span class="op">=</span><span class="fl">1.5</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">trait2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Phylomorphospace-1.png" width="672"></div>
</div>
<div id="handling-multiple-trees" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Handling multiple trees<a class="anchor" aria-label="anchor" href="#handling-multiple-trees"><i class="fas fa-link"></i></a>
</h2>
<p>In several cases, it is important to know how to handle multiple trees in R. These are normally stored in a <code>multiPhylo</code> object. Let’s see an example.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/pbtree.html">pbtree</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">15</span>,nsim<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">trees</span></span></code></pre></div>
<pre><code>## 10 phylogenetic trees</code></pre>
<p>You can see that the object is not the same as a phylo object. For instance, if you use the code <code>plot(trees)</code>, you will be prompted to hit enter to pass from one tree to the other. To access to individual trees, you need to use the following technique.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>## 
## Phylogenetic tree with 15 tips and 14 internal nodes.
## 
## Tip labels:
##   t3, t4, t5, t14, t15, t8, ...
## 
## Rooted; includes branch lengths.</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/multiPhylo%20manipulation-1.png" width="672"></div>
</div>
<div id="manipulating-trees" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Manipulating trees<a class="anchor" aria-label="anchor" href="#manipulating-trees"><i class="fas fa-link"></i></a>
</h2>
<p>There are several manipulations that can be made to trees. Here are a few examples.</p>
<div id="drop-tips" class="section level3" number="14.5.1">
<h3>
<span class="header-section-number">14.5.1</span> Drop tips<a class="anchor" aria-label="anchor" href="#drop-tips"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/drop.tip.html">drop.tip</a></span><span class="op">(</span><span class="va">tree</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"t1"</span>,<span class="st">"t2"</span>,<span class="st">"t3"</span>,<span class="st">"t4"</span>,<span class="st">"t5"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Drop%20tips-1.png" width="672"></div>
</div>
<div id="reroot-trees" class="section level3" number="14.5.2">
<h3>
<span class="header-section-number">14.5.2</span> Reroot trees<a class="anchor" aria-label="anchor" href="#reroot-trees"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/root.html">root</a></span><span class="op">(</span><span class="va">tree</span>,<span class="st">"t1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="pcm-workshop_files/figure-html/Reroot%20trees-1.png" width="672"></div>
</div>
<div id="get-cophenetic-distances" class="section level3" number="14.5.3">
<h3>
<span class="header-section-number">14.5.3</span> Get cophenetic distances<a class="anchor" aria-label="anchor" href="#get-cophenetic-distances"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/cophenetic.phylo.html">cophenetic.phylo</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            t3        t4        t7        t8       t2        t14        t15
## t3  0.0000000 0.7285289 3.4533793 3.4533793 3.453379 4.29496600 4.29496600
## t4  0.7285289 0.0000000 3.4533793 3.4533793 3.453379 4.29496600 4.29496600
## t7  3.4533793 3.4533793 0.0000000 0.4962115 1.250834 4.29496600 4.29496600
## t8  3.4533793 3.4533793 0.4962115 0.0000000 1.250834 4.29496600 4.29496600
## t2  3.4533793 3.4533793 1.2508336 1.2508336 0.000000 4.29496600 4.29496600
## t14 4.2949660 4.2949660 4.2949660 4.2949660 4.294966 0.00000000 0.03691962
## t15 4.2949660 4.2949660 4.2949660 4.2949660 4.294966 0.03691962 0.00000000
## t9  4.2949660 4.2949660 4.2949660 4.2949660 4.294966 0.88909442 0.88909442
## t12 4.2949660 4.2949660 4.2949660 4.2949660 4.294966 0.88909442 0.88909442
## t13 4.2949660 4.2949660 4.2949660 4.2949660 4.294966 0.88909442 0.88909442
## t5  7.8556290 7.8556290 7.8556290 7.8556290 7.855629 7.85562897 7.85562897
## t6  7.8556290 7.8556290 7.8556290 7.8556290 7.855629 7.85562897 7.85562897
## t1  7.8556290 7.8556290 7.8556290 7.8556290 7.855629 7.85562897 7.85562897
## t10 7.8556290 7.8556290 7.8556290 7.8556290 7.855629 7.85562897 7.85562897
## t11 7.8556290 7.8556290 7.8556290 7.8556290 7.855629 7.85562897 7.85562897
##            t9       t12       t13        t5        t6       t1      t10
## t3  4.2949660 4.2949660 4.2949660 7.8556290 7.8556290 7.855629 7.855629
## t4  4.2949660 4.2949660 4.2949660 7.8556290 7.8556290 7.855629 7.855629
## t7  4.2949660 4.2949660 4.2949660 7.8556290 7.8556290 7.855629 7.855629
## t8  4.2949660 4.2949660 4.2949660 7.8556290 7.8556290 7.855629 7.855629
## t2  4.2949660 4.2949660 4.2949660 7.8556290 7.8556290 7.855629 7.855629
## t14 0.8890944 0.8890944 0.8890944 7.8556290 7.8556290 7.855629 7.855629
## t15 0.8890944 0.8890944 0.8890944 7.8556290 7.8556290 7.855629 7.855629
## t9  0.0000000 0.4685481 0.4685481 7.8556290 7.8556290 7.855629 7.855629
## t12 0.4685481 0.0000000 0.2174902 7.8556290 7.8556290 7.855629 7.855629
## t13 0.4685481 0.2174902 0.0000000 7.8556290 7.8556290 7.855629 7.855629
## t5  7.8556290 7.8556290 7.8556290 0.0000000 0.5720997 1.742611 2.395633
## t6  7.8556290 7.8556290 7.8556290 0.5720997 0.0000000 1.742611 2.395633
## t1  7.8556290 7.8556290 7.8556290 1.7426110 1.7426110 0.000000 2.395633
## t10 7.8556290 7.8556290 7.8556290 2.3956328 2.3956328 2.395633 0.000000
## t11 7.8556290 7.8556290 7.8556290 2.3956328 2.3956328 2.395633 0.268201
##          t11
## t3  7.855629
## t4  7.855629
## t7  7.855629
## t8  7.855629
## t2  7.855629
## t14 7.855629
## t15 7.855629
## t9  7.855629
## t12 7.855629
## t13 7.855629
## t5  2.395633
## t6  2.395633
## t1  2.395633
## t10 0.268201
## t11 0.000000</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="further-readings.html"><span class="header-section-number">13</span> Further readings</a></div>
<div class="next"><a href="solutions.html"><span class="header-section-number">15</span> Solutions to the challenges</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#trees"><span class="header-section-number">14</span> Introduction to phylogenies in R</a></li>
<li>
<a class="nav-link" href="#importing-and-plotting-trees"><span class="header-section-number">14.1</span> Importing and plotting trees</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simulate-a-tree"><span class="header-section-number">14.1.1</span> Simulate a tree</a></li>
<li><a class="nav-link" href="#simulating-characters"><span class="header-section-number">14.1.2</span> Simulating characters</a></li>
</ul>
</li>
<li><a class="nav-link" href="#import-data-into-r"><span class="header-section-number">14.2</span> Import data into R</a></li>
<li><a class="nav-link" href="#plot-trees"><span class="header-section-number">14.3</span> Plot trees</a></li>
<li><a class="nav-link" href="#handling-multiple-trees"><span class="header-section-number">14.4</span> Handling multiple trees</a></li>
<li>
<a class="nav-link" href="#manipulating-trees"><span class="header-section-number">14.5</span> Manipulating trees</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#drop-tips"><span class="header-section-number">14.5.1</span> Drop tips</a></li>
<li><a class="nav-link" href="#reroot-trees"><span class="header-section-number">14.5.2</span> Reroot trees</a></li>
<li><a class="nav-link" href="#get-cophenetic-distances"><span class="header-section-number">14.5.3</span> Get cophenetic distances</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Half-day Workshop on Phylogenetic Comparative Methods</strong>" was written by Simon Joly. It was last built on 2024-11-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
